# 서버 요청 속도 테스트 결과 정리 (동시 요청 1000개, 30초 기준)

## **테스트 환경**

- **서버 스펙**
  - **CPU**: Intel Core Ultra 7 258V (Lunar Lake, 16스레드)  
  - **RAM**: 32GB LPDDR5X (6400MHz)  
  - **NPU**: Intel AI Boost (AI 가속 전용)  
  - **GPU**: Intel Arc 140V (내장, 16GB)  
  - **스토리지**: Samsung MZVL21T0HCLR (1TB NVMe SSD)x2
- **운영체제**: Windows 11 Pro (64bit)  
- **실행 환경**: WSL2 (Ubuntu 24.04.1 LTS)
- **Node.js 버전**: v22.13.1 (WSL2 내 설치)  
- **테스트 조건**: 동시 연결 **1000개**, 테스트 시간 **30초**  
- **테스트 일시**: 17:04 ~ 18:06
- **테스트 환경**: 로컬 환경 (localhost)  

---

**비고**
- **코드는 Windows 파일 시스템(WSL 마운트 경로 `/mnt/d/`)** 에 위치
- **서버는 WSL2 환경에서 실행**
- **테스트는 WSL2 네트워크 스택을 통해 이루어졌음**
- **테스트 결과의 하드웨어 의존성**을 고려하여 위와 같은 **서버 사양**을 기록함.
  
---

## 테스트 대상:
1. Express → **E**  
2. Fastify → **F**
3. NestJS + Express → **NE**
4. NestJS + Fastify → **NF**

---

## **요약 표**

| **서버 유형** | **평균 지연 시간 (ms)** | **P99 (ms)** | **TPS (Req/Sec)** | **총 요청 수** | **데이터 전송량 (MB)** | **에러 수** |
|----------------|------------------------|--------------|-------------------|----------------|-----------------------|-------------|
| E              | 42.22                  | 59           | 18,592.41         | 559,000        | 138 MB                | 437         |
| F              | 10.1                   | 19           | 94,488            | 2,836,000      | 522 MB                | 0           |
| NE             | 43.04                  | 63           | 17,365.67         | 523,000        | 133 MB                | 599         |
| NF             | 14.79                  | 19           | 65,450.67         | 1,964,000      | 379 MB                | 0           |

---

### **Express**

- **평균 응답 시간:** 42.22ms
- **TPS:** 18,592 req/sec
- **총 요청 수:** 559,000개
- **에러:** 437(타임아웃웃)

**→ 동시 1000개 요청에 대해 응답 속도와 안정성 부족**

---

###  **Fastify**

- **평균 응답 시간:** 10.1ms
- **TPS:** 94,488
- **총 요청 수:** 2,836,000개 
- **에러:** 없음  

**→ Fastify는 동시 1000개 요청에서도 안정성과 성능 우수**

---

### **NestJS + Express**

- **평균 응답 시간:** 43.04ms
- **TPS:** 17,365 req/sec  
- **총 요청 수:** 523,000개
- **에러:** 599개(타임아웃웃) 

**→ NestJS의 DI와 Express의 오버헤드가 시너지로 작용한 결과**

---

### **NestJS + Fastify**

- **평균 응답 시간:** 14.79ms
- **TPS:** 65,450 req/sec  
- **총 요청 수:** 1,964,000개  
- **에러:** 없음  

**→ NestJS를 사용하더라도 Fastify 사용으로 안정성과 성능 개선**

---

## **결론**

### **성능 분석**

- **Fastify**: 동시 요청 1000개, 30초 동안 **최대 TPS(Transactions Per Second)** **94,488**로 **가장 우수한 성능**을 기록.  
  - **평균 응답 시간**: 10.1ms  
  - **총 요청 수**: 2,836,000개  
  - **타임아웃 에러**: 0건  
  - **이벤트 루프 최적화**와 **HTTP 파서의 효율성**이 **Express 대비 약 5배 성능 우위**를 나타냄.  

- **NestJS + Fastify**: Fastify의 장점을 대부분 유지하면서 **NestJS의 DI(Dependency Injection) 구조**로 인한 오버헤드로 성능 하락.  
  - **평균 응답 시간**: 14.79ms  
  - **총 요청 수**: 1,964,000개  
  - **타임아웃 에러**: 0건  
  - **NestJS의 내부 로직 오버헤드**에도 불구하고 **Fastify의 고효율 아키텍처** 덕분에 안정적인 성능 유지.  

- **Express**: **Node.js 기본 웹 프레임워크**로서 **빠른 개발 생산성**은 보장하나, **동시 요청 처리 성능**은 다소 부족.  
  - **평균 응답 시간**: 42.22ms  
  - **총 요청 수**: 559,000개  
  - **타임아웃 에러**: 437건  
  - **싱글 스레드 이벤트 루프**의 **동시 요청 처리 한계**와 **HTTP 파서 비효율성**이 병목으로 작용.  

- **NestJS + Express**: 성능과 안정성 모두 **4가지 테스트 중 가장 열악**한 결과를 기록.  
  - **평균 응답 시간**: 43.04ms  
  - **총 요청 수**: 523,000개  
  - **타임아웃 에러**: 599건  
  - **NestJS의 런타임 오버헤드**와 **Express의 비효율적인 요청 처리 구조**가 맞물려 성능이 심각하게 저하.  

---

### **WSL 환경의 성능 영향 분석**

- **테스트는 WSL2 환경**에서 실행되었으며, **코드는 Windows 파일 시스템(WSL 마운트 경로 `/mnt/d`)** 에 위치.  
- **WSL2의 NAT(Network Address Translation)** 구조로 인해 **네트워크 성능에 약간의 오버헤드 발생 가능성** 존재.  
- **WSL 네트워크 스택**은 **Windows 호스트와 별도로 동작**하므로,  
  **실제 Windows 네이티브 환경**에서의 성능과는 **차이가 발생할 수 있음**.  

**특히,**  
- **WSL2 내 파일 접근** 시 **Windows 마운트 경로(/mnt/d)에서 성능이 저하**될 수 있음.  
- **테스트 중 평균 지연 시간이 예상보다 높게 나타난 원인**으로 **파일 I/O 병목 가능성**이 존재.  

**결론:** **동일한 테스트를 위해**는 **코드를 WSL2의 내부 파일시스템(/home)으로 이동**하여 **다시 테스트**하는 것이 **보다 정확한 성능 측정**을 보장할 수 있음.  

---

### **성능 최적화를 위한 개선 방향**

1. **NestJS 환경** 최적화  
    - **NestJS + Fastify** 환경이 **Fastify 대비 성능이 30% 이상 감소**.  
    - **DI 컨테이너 로딩 속도 개선** 및 **HTTP 파이프라인 최적화** 필요.  
    - **Fastify Adapter** 사용 시 **인터셉터 로직 최소화** 권장.  

2. **Express 서버 개선 포인트**  
    - **HTTP Keep-Alive 옵션 활성화**로 **연결 재사용** 최적화.  
    - **Express 내부 미들웨어** 중 **성능 병목 구간 식별**.  

3. **WSL2 환경 성능 개선**  
    - **코드를 `/mnt/` 대신 `/home/` 디렉토리로 이동**하여 **디스크 I/O 성능 개선**.  
    - **WSL2 네트워크 설정 최적화**(`/etc/sysctl.conf` 수정).  
    - **TCP Fast Open(TFO) 활성화**로 **패킷 전송 효율성 개선**.  

---

### **최종 결론**

**이번 테스트에서 Fastify는 Express 기반 서버 대비**  
- **요청 처리량(TPS)**: **5배 이상** 우수.  
- **지연 시간(Latency)**: **4배 이상 빠름**.  
- **타임아웃 오류 발생률**: **0% 기록** *(Express는 약 0.7% 발생)*.

---

### ⚠️ **테스트 코드의 단순성 관련 주의사항**

- **본 테스트는 단순히 HTTP 요청 응답 속도를 측정하기 위한 코드로 작성**됨.  
- **실제 애플리케이션 환경에서 발생할 수 있는** 다음 요소들은 **반영되어 있지 않음**:  
  - **미들웨어 체인**(Express의 경우 미들웨어 레이어의 성능 오버헤드)  
  - **데이터베이스 I/O**(MongoDB, PostgreSQL 등의 쿼리 처리 비용)  
  - **비즈니스 로직 처리**(CPU 연산, 비동기 작업, 큐 처리 등)  
  - **에러 핸들링 및 로깅 로직**(try-catch 블록, 에러 리스너 등)  

- **따라서, Fastify가 Express보다 상대적으로 더 우수한 성능을 보이는 결과는**  
  **HTTP 핸들러의 기본 성능에 초점이 맞춰져 있기 때문**이며,  
  **실제 환경에서는 성능 차이가 다르게 나타날 수 있음**.


## **서버 테스트 로그**


### **Express**
```plaintext
autocannon -c 1000 -d 30 http://localhost:3001  
Running 30s test @ http://localhost:3001
1000 connections

┌─────────┬───────┬───────┬───────┬───────┬──────────┬───────────┬──────────┐
│ Stat    │ 2.5%  │ 50%   │ 97.5% │ 99%   │ Avg      │ Stdev     │ Max      │
├─────────┼───────┼───────┼───────┼───────┼──────────┼───────────┼──────────┤
│ Latency │ 25 ms │ 38 ms │ 53 ms │ 59 ms │ 42.22 ms │ 151.63 ms │ 10000 ms │
└─────────┴───────┴───────┴───────┴───────┴──────────┴───────────┴──────────┘

┌───────────┬─────────┬─────────┬─────────┬────────┬───────────┬─────────┬─────────┐
│ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%  │ Avg       │ Stdev   │ Min     │
├───────────┼─────────┼─────────┼─────────┼────────┼───────────┼─────────┼─────────┤
│ Req/Sec   │ 11,575  │ 11,575  │ 18,895  │ 19,439 │ 18,592.41 │ 1,357.9 │ 11,572  │
├───────────┼─────────┼─────────┼─────────┼────────┼───────────┼─────────┼─────────┤
│ Bytes/Sec │ 2.86 MB │ 2.86 MB │ 4.67 MB │ 4.8 MB │ 4.59 MB   │ 335 kB  │ 2.86 MB │
└───────────┴─────────┴─────────┴─────────┴────────┴───────────┴─────────┴─────────┘

Req/Bytes counts sampled once per second.
# of samples: 30

559k requests in 29.23s, 138 MB read
437 errors (437 timeouts)

```
### **Fastify**
```plaintext
autocannon -c 1000 -d 30 http://localhost:3002  
Running 30s test @ http://localhost:3002
1000 connections

┌─────────┬──────┬──────┬───────┬───────┬─────────┬──────────┬─────────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%   │ Avg     │ Stdev    │ Max     │
├─────────┼──────┼──────┼───────┼───────┼─────────┼──────────┼─────────┤
│ Latency │ 6 ms │ 9 ms │ 17 ms │ 19 ms │ 10.1 ms │ 16.89 ms │ 2590 ms │
└─────────┴──────┴──────┴───────┴───────┴─────────┴──────────┴─────────┘

┌───────────┬─────────┬─────────┬─────────┬─────────┬─────────┬──────────┬─────────┐
│ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%   │ Avg     │ Stdev    │ Min     │
├───────────┼─────────┼─────────┼─────────┼─────────┼─────────┼──────────┼─────────┤
│ Req/Sec   │ 64,703  │ 64,703  │ 95,231  │ 101,055 │ 94,488  │ 5,859.58 │ 64,680  │
├───────────┼─────────┼─────────┼─────────┼─────────┼─────────┼──────────┼─────────┤
│ Bytes/Sec │ 11.9 MB │ 11.9 MB │ 17.5 MB │ 18.6 MB │ 17.4 MB │ 1.08 MB  │ 11.9 MB │
└───────────┴─────────┴─────────┴─────────┴─────────┴─────────┴──────────┴─────────┘

Req/Bytes counts sampled once per second.
# of samples: 30

2836k requests in 29.2s, 522 MB read
```     
### **NestJS + Express**
```plaintext
autocannon -c 1000 -d 30 http://localhost:3003  
Running 30s test @ http://localhost:3003
1000 connections

┌─────────┬───────┬───────┬───────┬───────┬──────────┬───────────┬─────────┐
│ Stat    │ 2.5%  │ 50%   │ 97.5% │ 99%   │ Avg      │ Stdev     │ Max     │
├─────────┼───────┬───────┬───────┬───────┬──────────┬───────────┬─────────┤
│ Latency │ 29 ms │ 41 ms │ 55 ms │ 63 ms │ 43.04 ms │ 128.75 ms │ 9972 ms │
└─────────┴───────┴───────┴───────┴───────┴──────────┴───────────┴─────────┘

┌───────────┬────────┬────────┬─────────┬─────────┬───────────┬──────────┬────────┐
│ Stat      │ 1%     │ 2.5%   │ 50%     │ 97.5%   │ Avg       │ Stdev    │ Min    │
├───────────┼────────┼────────┼─────────┼─────────┼───────────┼──────────┼────────┤
│ Req/Sec   │ 8,187  │ 8,187  │ 17,711  │ 18,703  │ 17,365.67 │ 1,778.14 │ 8,185  │
├───────────┼────────┼────────┼─────────┼─────────┼───────────┼──────────┼────────┤
│ Bytes/Sec │ 2.1 MB │ 2.1 MB │ 4.53 MB │ 4.79 MB │ 4.45 MB   │ 455 kB   │ 2.1 MB │
└───────────┴────────┴────────┴─────────┴─────────┴───────────┴──────────┴────────┘

Req/Bytes counts sampled once per second.
# of samples: 30

523k requests in 30.07s, 133 MB read
599 errors (599 timeouts)
```
### **NestJS + Fastify**
```plaintext
autocannon -c 1000 -d 30 http://localhost:3004  
Running 30s test @ http://localhost:3004
1000 connections

┌─────────┬──────┬───────┬───────┬───────┬──────────┬──────────┬─────────┐
│ Stat    │ 2.5% │ 50%   │ 97.5% │ 99%   │ Avg      │ Stdev    │ Max     │
├─────────┼──────┼───────┬───────┴───────┬──────────┬──────────┬─────────┤
│ Latency │ 6 ms │ 14 ms │ 17 ms │ 19 ms │ 14.79 ms │ 75.08 ms │ 7466 ms │
└─────────┴──────┴───────┴───────┴───────┴──────────┴──────────┴─────────┘

┌───────────┬─────────┬─────────┬─────────┬─────────┬───────────┬──────────┬─────────┐
│ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%   │ Avg       │ Stdev    │ Min     │
├───────────┼─────────┼─────────┼─────────┼─────────┼───────────┼──────────┼─────────┤
│ Req/Sec   │ 40,479  │ 40,479  │ 66,623  │ 67,839  │ 65,450.67 │ 4,785.23 │ 40,469  │
├───────────┼─────────┼─────────┼─────────┼─────────┼───────────┼──────────┼─────────┤
│ Bytes/Sec │ 7.81 MB │ 7.81 MB │ 12.9 MB │ 13.1 MB │ 12.6 MB   │ 924 kB   │ 7.81 MB │
└───────────┴─────────┴─────────┴─────────┴─────────┴───────────┴──────────┴─────────┘

Req/Bytes counts sampled once per second.
# of samples: 30

1964k requests in 29.14s, 379 MB read
